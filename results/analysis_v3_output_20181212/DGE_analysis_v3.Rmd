---
title: "Generation of DEG lists with revised methods"
output: html_notebook
---


```{r setup, include=FALSE}

library(openxlsx)
library(edgeR)
library(ggplot2)
library(gplots)
library(plotly)
library(stats)
library(VennDiagram)
library(stringr)

dirPath <- "C:/Users/Morgan/Documents/Lab Stuff/RNA seq/My_results/analysis_v3_output"

```

## Description

### v3 Description Dec. 5, 2018

V3 of this analysis code is intended to be the final major revision, updates to this revision from v2 focus on naming comparisions and files more consistently, saving all results we need to a hierarchical folder system, and clean up of un-needed code chunks. 


### v2 notes
With Feedback from a meeting on Oct. 26, 2018, this analysis is updated to use more consistent parameters for defining sets of differentially expressed genes (DEGs).

The key updates are:
* Use more stringent filter for genes based on level of expression
* use wound control to eliminate genes before analysis to help FDR when identifying genes between S and R conditions
* Use a reasonable FDR cutouff
* use a consistent fold change filter

## Functions:

```{r}

makeFname <- function(folder, cont, change="", dtype="", FDRmax, logFCmin){
  filename <- paste(folder, "/", cont, change, dtype, "_FDR", 
                    str_pad(FDRmax*100, 2, pad="0"), "_LFC", 
                    str_pad(logFCmin,2, pad=0), "_", 
                    format(Sys.time(), "%Y%m%d"), sep="")
  if (dtype %in% c("", "_At_homologs")){
    filename <- paste(filename, ".csv", sep="")
  } else if (grepl("plot|hist|diag", dtype)){
    filename <- paste(filename, ".png", sep="")
  }
  return(filename)
}


save_DEGs <- function(DEGList, folder, cont, FDRmax, logFCmin, dir){
  DEGs <- DEGList
  DEGs$Gene_ID <- row.names(DEGs)
  DEGs <- dplyr::left_join(DEGs, edinburghGeneInfo, by="Gene_ID")
  row.names(DEGs) <- DEGs$Gene_ID
  
  # fname <- makeFname(folder=folder, cont=cont, FDRmax=FDRmax, logFCmin=logFCmin)
  # fPath <- file.path(dirPath, fname)
  # write.csv(DEGs, fPath, row.names=TRUE)
  
  fname <- makeFname(folder=folder, cont=cont, change="_UP", FDRmax=FDRmax, logFCmin=logFCmin)
  fPath <- file.path(dirPath, fname)
  write.csv(subset(DEGs, logFC > 0), fPath, row.names=TRUE)
  
  fname <- makeFname(folder=folder, cont=cont, change="_DOWN", FDRmax=FDRmax, logFCmin=logFCmin)
  fPath <- file.path(dirPath, fname)
  write.csv(subset(DEGs, logFC < 0), fPath, row.names=TRUE)
  
  fname <- makeFname(folder=paste(folder, "/GO_lists", sep=""), cont=cont, 
                     change="_UP", dtype="_At_homologs", FDRmax=FDRmax, logFCmin=logFCmin)
  fPath <- file.path(dirPath, fname)
  write.table(subset(DEGs, (logFC>0)&(!is.na(Symbol)), select="A._thaliana_best_hit"), fPath, 
            row.names=FALSE, na="", col.names=FALSE, sep=",")
  
  fname <- makeFname(folder=paste(folder, "/GO_lists", sep=""), cont=cont, 
                     change="_DOWN", dtype="_At_homologs", FDRmax=FDRmax, logFCmin=logFCmin)
  fPath <- file.path(dirPath, fname)
  write.table(subset(DEGs, (logFC<0)&(!is.na(Symbol)), select="A._thaliana_best_hit"), fPath, 
            row.names=FALSE, na="", col.names=FALSE, sep=",")
}

addWoundCtrl <- function(DEGs, woundIDs){
  output <- DEGs
  output$woundCtrl <- row.names(DEGs) %in% woundIDs
  return(output)
}


mergeGenes <- function(genesA, genesB){
  genesA$Gene_ID <- row.names(genesA)
  genesB$Gene_ID <- row.names(genesB)
  commonGenes <- dplyr::inner_join(genesA, genesB, by="Gene_ID")
  row.names(commonGenes) <- commonGenes$Gene_ID
  return(commonGenes)
}

se <- function(x){
  # calculate standard error of x
  sd(x)/sqrt(length(x))
} 

group2Line <- Vectorize(function(group){
  switch(group,
         phyB.24 = 1,
         phyB.P = 1,
         phyB.R = 2,
         phyB.S = 2,
         WT.24 = 3,
         WT.P = 3,
         WT.R = 4,
         WT.S = 4)
})

plotDE <- function(geneId, normExpr, display=TRUE, save=FALSE, saveDir="", fileType="svg", ...){
  normExpr <- data.frame(normExpr)
  group <- gsub("_\\d_", ".", colnames(normExpr))
  geneData <- as.data.frame(t(normExpr[geneId, ]))
  geneData$group <- group
  geneData <- dplyr::group_by(geneData, group)
  dataSummary <- dplyr::summarise(geneData, mean=mean(!!rlang::sym(geneId)), 
                                  SE=se(!!rlang::sym(geneId)))
  dataSummary <- tidyr::separate(dataSummary, group, 
                                 into=c("Genotype", "Timepoint"), sep="[.]", 
                                 remove=FALSE)
  dataSummary$Timepoint <- factor(dataSummary$Timepoint, levels=c("P", "24", "S", "R"))
  dataSummary$line <- group2Line(dataSummary$group)
  # make plot
  plot <- ggplot(dataSummary, aes(x=Timepoint, y=mean, color=Genotype)) + geom_point(size=2) + 
    geom_errorbar(aes(ymin=mean-SE, ymax=mean+SE), width=0.2) + geom_line(aes(group=line)) + 
    expand_limits(y=0) + labs(title=geneId, y="Relative Expression")
  if (display) {
    print(plot)
  }
  if (save) {
    if (!file.exists(saveDir)) {
      stop("the save directory does not exist")
    }
    saveFile <- file.path(saveDir, paste(geneId, " expression plot.", fileType, sep=""))
    if (file.exists(saveFile)) {
      warning(paste(saveFile, "is being overwritten"))
    }
    ggsave(saveFile, plot, device=fileType, ...)
  }
}


geneHeatmap <- function(genes, DGEdata, groupAv=TRUE, rsOnly=TRUE){
  
  DEGCpm <- cpm(DGEdata[genes, ])
  sampleOrder <- c(
    "WT_3_P",   "WT_4_P",   "WT_5_P",   "WT_6_P",    
    "phyB_3_P", "phyB_4_P", "phyB_5_P",
    "WT_3_24",  "WT_4_24",  "WT_5_24",  "WT_6_24", 
    "phyB_3_24","phyB_4_24","phyB_5_24",
    "WT_3_S",   "WT_4_S",   "WT_5_S",   "WT_6_S",    
    "phyB_3_S", "phyB_4_S", "phyB_5_S",
    "WT_3_R",   "WT_4_R",   "WT_5_R",   "WT_6_R",
    "phyB_3_R", "phyB_4_R", "phyB_5_R",
    "WT.S_P",   "phyB.S_P", "WT.R_S",   "phyB.R_S") 
  sampleOrder <- sampleOrder[sampleOrder %in% colnames(DEGCpm)]
  DEGCpm <- DEGCpm[, sampleOrder]
  group <- gsub("_\\d_", ".", colnames(DEGCpm))
  if (groupAv) {
    DEGCpm2 <- as.data.frame(t(DEGCpm))
    DEGCpm2 <- stats::aggregate(DEGCpm2, by=list(group), FUN=mean)
    row.names(DEGCpm2) <- DEGCpm2$Group.1
    DEGCpm2 <- DEGCpm2[, -1]
    DEGCpm <- t(DEGCpm2)
    groupOrder <- c("WT.P", "phyB.P", "WT.24", "phyB.24", "WT.S", "phyB.S", "WT.R", "phyB.R")
    groupOrder <- groupOrder[groupOrder %in% colnames(DEGCpm)]
    DEGCpm <- DEGCpm[, groupOrder]
  }
  if (rsOnly){
    DEGCpm <- DEGCpm[, !grepl("P|(24)", colnames(DEGCpm))]
  }
  hr <- hclust(as.dist(1-cor(t(DEGCpm), method="pearson")), method="complete")
  fig <- heatmap.2(DEGCpm, dendrogram="row", Rowv=as.dendrogram(hr), trace="none",
          col="bluered", scale="row", Colv=NA, margins=c(8,7))
  return(fig)
}


commonGenes <- function(DEGsA, DEGsB){
  commonIDs <- row.names(DEGsA)[row.names(DEGsA) %in% row.names(DEGsB)]
  DEGsA[commonIDs, ]
}

doubleVenn <- function(DEG1, DEG2, name1="Set1", name2="Set2"){
  overlap <- nrow(commonGenes(DEG1, DEG2))
  
  draw.pairwise.venn(area1=nrow(DEG1), area2=nrow(DEG2), 
                     cross.area=overlap, 
                     fill=c("red", "blue"), category=c(name1, name2))
}

tripVenn <- function(DEG1, DEG2, DEG3, names=c("Set1", "Set2", "Set3")){
  genes12 <- commonGenes(DEG1, DEG2)
  genes23 <- commonGenes(DEG2, DEG3)  
  genes13 <- commonGenes(DEG1, DEG3)
  genes123 <- commonGenes(DEG1, genes23)
  
  draw.triple.venn(area1=nrow(DEG1), area2=nrow(DEG2), area3=nrow(DEG3),
                   n12=nrow(genes12), n23=nrow(genes23), n13=nrow(genes13), 
                   n123=nrow(genes123),
                   fill=c("red", "blue", "green"), category=names, scaled=FALSE)
}

nVenn <- function(DEGsList){
  DEGVenn <- Venn(DEGsList)
  gp <- VennThemes(compute.Venn(DEGVenn))
  gp$SetText <- lapply(gp$SetText,function(x) {x$fontsize<-10; return(x)})
  plot(DEGVenn, doWeights=FALSE,gp=gp)
}

```

## get gene Info from Edinburgh results

```{r}

edinTests <- c("wt.24h_vs_wt.pre", "phyB.24h_vs_phyB.pre", "wt.sen_vs_wt.pre",
               "phyB.sen_vs_phyB.pre", "phyB.sen-pre_vs_wt.sen-pre",
               "wt.rec_vs_wt.sen", "phyB.rec_vs_phyB.sen", 
               "phyB.rec-sen_vs_wt.rec-sen")


edinburghPath <- "C:/Users/Morgan/Documents/Lab Stuff/RNA seq/Edinburgh_results"

edinburghGenes <- data.frame()

for (test in edinTests){
  fname <- list.files(edinburghPath, pattern=test, full.names=TRUE)
  df <- read.xlsx(xlsxFile=fname, sheet=1, skipEmptyRows=FALSE)
  edinburghGenes <- rbind(edinburghGenes, df)
}

edinburghGeneInfo <- unique(edinburghGenes[, 1:6])

```




## Loading the data

The code below for loading the data is largely unchanged from previous .Rmd docs.
With the exception that a more stringent filter is being used to filter out genes with low expression

The filter criteria is to remove rows(genes) that have less than 3 samples having above 100 counts.

```{r}

counts <- read.csv("C:/Users/Morgan/Documents/Lab Stuff/RNA seq/raw_counts.csv",
                   row.names="X")

group <- factor(c(rep("WT.P",4), rep("WT.24", 4), rep("WT.S", 4), rep("WT.R", 4),
           rep("phyB.P", 3), rep("phyB.24", 3), rep("phyB.S", 3), 
           rep("phyB.R", 3)))

# create the DGEList object edgeR uses
DGEdata <- DGEList(counts=counts, group=group)

# filter out rows with fewer than 3 samples that have more than 10 counts/million
keep <- rowSums(cpm(DGEdata) > 10) >= 3
DGEdata <- DGEdata[keep, , keep.lib.sizes=FALSE]


# filter out rows with CPM less than 2 in fewer than 3 samples
# keep <- rowSums(cpm(DGEdata)>2) >= 3
# DGEdata <- DGEdata[keep, , keep.lib.sizes=FALSE]

```

### The `design` based on how Amaryllis made it

In this design, there are factors for genotype, plant, as well as genotype:timepoint.

```{r}

sampleCond <- data.frame(limma::strsplit2(colnames(counts), "_"))
colnames(sampleCond) <- c("Genotype", "Plant", "Timepoint")

# re order factor levels to ensure model intercept is correct
sampleCond$Genotype <- factor(sampleCond$Genotype, c("WT", "phyB"))
sampleCond$Plant <- factor(sampleCond$Plant, c("3", "4", "5", "6"))
sampleCond$Timepoint <- factor(sampleCond$Timepoint, c("P", "24", "S", "R"))

# create the model matrix used for the linear model
design <- model.matrix( ~Genotype + Genotype:Plant + Genotype:Timepoint, data=sampleCond)
# remove column because there is no phyB plant #6
design <- design[, !(colnames(design) %in% c("GenotypephyB:Plant6"))] 

# simplify column names of design
colnames(design) <- gsub("Genotype|Timepoint|Plant", "", colnames(design))
colnames(design) <- gsub(":", ".", colnames(design))

# rename intercept column to avoid warning further down
colnames(design)[colnames(design) == "(Intercept)"] <- "Intercept" 
colnames(design)[colnames(design) == "24"] <- "T24"

```

### Contrasts

```{r}
fullContrasts <- makeContrasts("WT.24_vs_WT.P" = WT.24,
                               "phyB.24_vs_phyB.P" = phyB.24,
                               "WT.S_vs_WT.P" = WT.S,
                               "phyB.S_vs_phyB.P" = phyB.S,
                               "WT.R_vs_WT.S" = (WT.R - WT.S),  
                               "phyB.R_vs_phyB.S" = phyB.R - phyB.S,
                               
                               "phyB.24_vs_WT.24" = phyB.24 - WT.24,
                               "phyB.R_vs_WT.R" = phyB.R - WT.R,
                               "phyB.S_vs_WT.S" = phyB.S - WT.S,
                             
                               "phyB.R-S_vs_WT.R-S" = (phyB.R - phyB.S) - (WT.R - WT.S),
                               "phyB.S-P_vs_WT.S-P" = phyB.S - WT.S,
                             
                               "phyB.P_vs_WT.P" = 2*phyB + WT.24 + WT.S + 
                                 WT.R - phyB.24 - phyB.S - phyB.R,
                             
                             levels = design)
```

### linear model fit

```{r}
woundDesign <- design[c(1:8,17:22), c(1:9)] 
woundDGEdata <- DGEdata[, c(1:8,17:22)]
woundDGEdata <- calcNormFactors(woundDGEdata)
# estimate dispersion
woundDGEdata <- estimateDisp(woundDGEdata, design=woundDesign)
# generalized linear model
# woundFit <- glmQLFit(woundDGEdata, woundDesign)



DGEdata <- calcNormFactors(DGEdata)
# estimate dispersion
DGEdata <- estimateDisp(DGEdata, design=design)
# generalized linear model
LmFit <- glmQLFit(DGEdata, design)
```



# Analysis




## Wound Control

### phyB.(24-P) vs WT.(24-P)

```{r}
# --- inputs --- #
folder <- "wound_control"
cont <- "phyB.24_vs_WT.24"
FDRmax <- 0.05
logFCmin <- 0
# ---        --- #
qlf <- glmQLFTest(LmFit, contrast=fullContrasts[, cont])
allGenes <- as.data.frame(topTags(qlf, n=Inf, p.value=1)) 
DEGs <- subset(allGenes, (FDR<FDRmax) & (abs(logFC)>logFCmin))
save_DEGs(DEGs, folder, cont, FDRmax, logFCmin, dirPath)



fig <- hist(allGenes$PValue, breaks=40, main=paste(cont, "p-value histogram", sep=" "),
         xlab = "p-value")

figFile <- makeFname(folder=paste(folder, "/plots", sep=""), cont=cont, 
                     dtype="_p_val_hist", FDRmax=FDRmax, logFCmin=logFCmin)
figFile <- file.path(dirPath, figFile)

dev.copy(png, figFile)
dev.off


```

The linear model does not do a good job here, see how the p-value histogram drops off as it nears 0. we believe this is due to the dispersion/variance of the data being dominated by the S condition, removing S from the model improves the 

NOTE: even the exact test is influenced by the dispersion calculation and thus by the S condition.

To avoid our wound control gene lists being impacted by the S condition and the linear model, we will use direct comparisons with fischer exact tests to generate wound control genes.

### WT.24 vs WT.P

```{r echo=FALSE}
# --- inputs --- #
folder <- "wound_control"
cont <- "WT.24_vs_WT.P_exact"
FDRmax <- 0.05
logFCmin <- 2
# --- ------ --- #
exTest <- exactTest(woundDGEdata, pair=c("WT.24", "WT.P"))
allGenes <- as.data.frame(topTags(exTest, n=Inf, p.value=1)) 
DEGs <- subset(allGenes, (FDR<FDRmax) & (abs(logFC)>logFCmin))
save_DEGs(DEGs, folder, cont, FDRmax, logFCmin, dirPath)

woundDEGsWT <- DEGs

fig <- hist(allGenes$PValue, breaks=40, main=paste(cont, "p-value histogram", sep=" "),
         xlab = "p-value")

figFile <- makeFname(folder=paste(folder, "/plots", sep=""), cont=cont, 
                     dtype="_p_val_hist", FDRmax=FDRmax, logFCmin=logFCmin)
figFile <- file.path(dirPath, figFile)

dev.copy(png, figFile)
dev.off()

```


### phyB.24 - phyB.P 

```{r echo=FALSE}
# --- inputs --- #
folder <- "wound_control"
cont <- "phyB.24_vs_phyB.P_exact"
FDRmax <- 0.05
logFCmin <- 2
# --- ------ --- #
exTest <- exactTest(woundDGEdata, pair=c("phyB.24", "phyB.P"))
allGenes <- as.data.frame(topTags(exTest, n=Inf, p.value=1)) 
DEGs <- subset(allGenes, (FDR<FDRmax) & (abs(logFC)>logFCmin))
save_DEGs(DEGs, folder, cont, FDRmax, logFCmin, dirPath)

woundDEGsphyB <- DEGs

hist(allGenes$PValue, breaks=40, main=paste(cont, "p-value histogram", sep=" "),
         xlab = "p-value")

figFile <- makeFname(folder=paste(folder, "/plots", sep=""), cont=cont, 
                     dtype="_p_val_hist", FDRmax=FDRmax, logFCmin=logFCmin)
figFile <- file.path(dirPath, figFile)

dev.copy(png, figFile)
dev.off()

```

### collection of all wound controll genes

```{r}
# --- inputs --- #
folder <- "wound_control"
cont <- "wound_ctrl_genes"
FDRmax <- 0.05
logFCmin <- 2
# --- ------ --- #
woundIDs <- unique(c(row.names(woundDEGsWT), row.names(woundDEGsphyB)))

fname <- makeFname(folder=folder, cont=cont, FDRmax=FDRmax, logFCmin=logFCmin)
fPath <- file.path(dirPath, fname)
write.table(woundIDs, fPath, row.names=FALSE, na="", col.names=FALSE, sep=",")

```






# Timepoint v. Timepoint

## S vs P

### WT S vs P

```{r}
# --- inputs --- #
folder <- "timepoint_v_timepoint"
cont <- "WT.S_vs_WT.P"
FDRmax <- 0.01
logFCmin <- 3
# --- ------ --- #

qlf <- glmQLFTest(LmFit, contrast=fullContrasts[, cont])
allGenes <- as.data.frame(topTags(qlf, n=Inf, p.value=1)) 
DEGs <- subset(allGenes, (FDR<FDRmax) & (abs(logFC)>logFCmin))
DEGs <- addWoundCtrl(DEGs, woundIDs)
save_DEGs(DEGs, folder, cont, FDRmax, logFCmin, dirPath)

hist(allGenes$PValue, breaks=40, main=paste(cont, "p-value histogram", sep=" "),
         xlab = "p-value")
figFile <- makeFname(folder=paste(folder, "/plots", sep=""), cont=cont, 
                     dtype="_p_val_hist", FDRmax=FDRmax, logFCmin=logFCmin)
figFile <- file.path(dirPath, figFile)
dev.copy(png, figFile)
dev.off()

# -- specific --- # 
allGenesWT_SvP <- allGenes
DEGsWT_SvP <- DEGs

head(DEGs, 20)

```


### phyB S vs P

```{r}
# --- inputs --- #
folder <- "timepoint_v_timepoint"
cont <- "phyB.S_vs_phyB.P"
FDRmax <- 0.01
logFCmin <- 3
# --- ------ --- #

qlf <- glmQLFTest(LmFit, contrast=fullContrasts[, cont])
allGenes <- as.data.frame(topTags(qlf, n=Inf, p.value=1)) 
DEGs <- subset(allGenes, (FDR<FDRmax) & (abs(logFC)>logFCmin))
DEGs <- addWoundCtrl(DEGs, woundIDs)
save_DEGs(DEGs, folder, cont, FDRmax, logFCmin, dirPath)

hist(allGenes$PValue, breaks=40, main=paste(cont, "p-value histogram", sep=" "),
         xlab = "p-value")
figFile <- makeFname(folder=paste(folder, "/plots", sep=""), cont=cont, 
                     dtype="_p_val_hist", FDRmax=FDRmax, logFCmin=logFCmin)
figFile <- file.path(dirPath, figFile)
dev.copy(png, figFile)
dev.off()

# -- specific --- # 
allGenesphyB_SvP <- allGenes
DEGsphyB_SvP <- DEGs

head(DEGs, 20)

```


### phyB S-P vs WT S-P

```{r}
# --- inputs --- #
folder <- "geno_x_timepoint"
cont <- "phyB.S-P_vs_WT.S-P"
FDRmax <- 0.1
logFCmin <- 0
# --- ------ --- #

qlf <- glmQLFTest(LmFit, contrast=fullContrasts[, cont])
allGenes <- as.data.frame(topTags(qlf, n=Inf, p.value=1)) 
DEGs <- subset(allGenes, (FDR<FDRmax) & (abs(logFC)>logFCmin))
DEGs <- addWoundCtrl(DEGs, woundIDs)
save_DEGs(DEGs, folder, cont, FDRmax, logFCmin, dirPath)

hist(allGenes$PValue, breaks=40, main=paste(cont, "p-value histogram", sep=" "),
         xlab = "p-value")
figFile <- makeFname(folder=paste(folder, "/plots", sep=""), cont=cont, 
                     dtype="_p_val_hist", FDRmax=FDRmax, logFCmin=logFCmin)
figFile <- file.path(dirPath, figFile)
dev.copy(png, figFile)
dev.off()

# --- specific --- #

DEGs_SvP <- DEGs
```


### Venn diagram of S vs. P

```{r}
# --- inputs --- #
folder <- "timepoint_v_timepoint/SvP_venn"
cont <- "SvP"
FDRmax <- 0.01
logFCmin <- 3
# --- ------ --- #


SvP_CommonGenes <- mergeGenes(DEGsphyB_SvP, DEGsWT_SvP) 
colnames(SvP_CommonGenes) <- gsub("\\.x", "_phyB", colnames(SvP_CommonGenes))
colnames(SvP_CommonGenes) <- gsub("\\.y", "_WT", colnames(SvP_CommonGenes))
SvP_CommonGenes <- dplyr::left_join(SvP_CommonGenes, edinburghGeneInfo, by="Gene_ID")
fname <- makeFname(folder=folder, cont="SvP_CommonGenes", FDRmax=FDRmax, logFCmin=logFCmin)
fPath <- file.path(dirPath, fname)
write.csv(SvP_CommonGenes, fPath, row.names=TRUE)

SvP_WT_Only <- DEGsWT_SvP[!(row.names(DEGsWT_SvP) %in% SvP_CommonGenes$Gene_ID), ]
save_DEGs(SvP_WT_Only, folder, "SvP_WT_only", FDRmax, logFCmin, dirPath)

SvP_phyB_Only <- DEGsphyB_SvP[!(row.names(DEGsphyB_SvP) %in% SvP_CommonGenes$Gene_ID), ]
save_DEGs(SvP_phyB_Only, folder, "SvP_phyB_only", FDRmax, logFCmin, dirPath)

plot.new()
temp <- draw.pairwise.venn(area1=nrow(SvP_WT_Only)+nrow(SvP_CommonGenes), 
                           area2=nrow(SvP_phyB_Only)+nrow(SvP_CommonGenes), 
                           cross.area=nrow(SvP_CommonGenes), 
                   fill=c("blue", "red"), category=c("WT S vs. P", "phyB S vs. P"))
grid.draw(temp)

figFile <- makeFname(folder=folder, cont=cont, dtype="_Venn_diag", FDRmax=FDRmax, logFCmin=logFCmin)
figFile <- file.path(dirPath, figFile)
dev.copy(png, figFile)
dev.off()


```

```{r}

allGenes_SvP <- mergeGenes(allGenesWT_SvP, allGenesphyB_SvP)

allGenes_SvP$group <- rep("Neither", nrow(allGenes_SvP))
allGenes_SvP[row.names(SvP_WT_Only), ]$group <- "WT_Only"
allGenes_SvP[row.names(SvP_phyB_Only), ]$group <- "phyB_Only"
allGenes_SvP[SvP_CommonGenes$Gene_ID, ]$group <- "Both"
allGenes_SvP[row.names(DEGs_SvP), ]$group <- "WT(S-P) vs. phyB(S-P) FDR<0.1"
allGenes_SvP_sig <- subset(allGenes_SvP, group != "Neither")

cols <- c("Neither"="grey", "WT_Only"="blue", "phyB_Only"="red", 
          "Both"="purple", "WT(S-P) vs. phyB(S-P) FDR<0.1"="green")

ggplot(allGenes_SvP, aes(x=PValue.x, y=PValue.y, color=group)) +
  geom_point(data=subset(allGenes_SvP, group=="Neither"), alpha=0.2) +
  geom_point(data=subset(allGenes_SvP, group=="Both"), alpha=0.5) +
  geom_point(data=subset(allGenes_SvP, group=="phyB_Only")) +  
  geom_point(data=subset(allGenes_SvP, group=="WT_Only")) +  
  geom_point(data=subset(allGenes_SvP, group=="WT(S-P) vs. phyB(S-P) FDR<0.1")) +  
  scale_color_manual(values=cols) +
  scale_x_log10() + scale_y_log10() + 
  labs(x = "WT p-value", y="phyB p-value", title="p-values S vs. P")

figFile <- makeFname(folder=folder, cont=cont, dtype="_pval_plot", FDRmax=FDRmax, logFCmin=logFCmin)
figFile <- file.path(dirPath, figFile)
dev.copy(png, figFile)
dev.off()


ggplot(allGenes_SvP, aes(x=logFC.x, y=logFC.y, color=group)) +
  geom_point(data=subset(allGenes_SvP, group=="Neither"), alpha=0.2) +
  geom_point(data=subset(allGenes_SvP, group=="Both"), alpha=.5) +
  geom_point(data=subset(allGenes_SvP, group=="phyB_Only")) +  
  geom_point(data=subset(allGenes_SvP, group=="WT_Only")) +  
  geom_point(data=subset(allGenes_SvP, group=="WT(S-P) vs. phyB(S-P) FDR<0.1")) +  
  scale_color_manual(values=cols) + 
  labs(x = "WT Log2 Fold Change", y="phyB Log2 Fold Change", title="Log Fold Change S vs. P")

figFile <- makeFname(folder=folder, cont=cont, dtype="_logFC_plot", FDRmax=FDRmax, logFCmin=logFCmin)
figFile <- file.path(dirPath, figFile)
dev.copy(png, figFile)
dev.off()
```





## R vs. S


### WT R vs. S

```{r}
# --- inputs --- #
folder <- "timepoint_v_timepoint"
cont <- "WT.R_vs_WT.S"
FDRmax <- 0.01
logFCmin <- 3
# --- ------ --- #

qlf <- glmQLFTest(LmFit, contrast=fullContrasts[, cont])
allGenes <- as.data.frame(topTags(qlf, n=Inf, p.value=1)) 
DEGs <- subset(allGenes, (FDR<FDRmax) & (abs(logFC)>logFCmin))
DEGs <- addWoundCtrl(DEGs, woundIDs)
save_DEGs(DEGs, folder, cont, FDRmax, logFCmin, dirPath)

hist(allGenes$PValue, breaks=40, main=paste(cont, "p-value histogram", sep=" "),
         xlab = "p-value")
figFile <- makeFname(folder=paste(folder, "/plots", sep=""), cont=cont, 
                     dtype="_p_val_hist", FDRmax=FDRmax, logFCmin=logFCmin)
figFile <- file.path(dirPath, figFile)
dev.copy(png, figFile)
dev.off()

# -- specific --- # 
allGenesWT_RvS <- allGenes
DEGsWT_RvS <- DEGs

head(DEGs, 20)

```


### phyB R vs. S

```{r}
# --- inputs --- #
folder <- "timepoint_v_timepoint"
cont <- "phyB.R_vs_phyB.S"
FDRmax <- 0.01
logFCmin <- 3
# --- ------ --- #

qlf <- glmQLFTest(LmFit, contrast=fullContrasts[, cont])
allGenes <- as.data.frame(topTags(qlf, n=Inf, p.value=1)) 
DEGs <- subset(allGenes, (FDR<FDRmax) & (abs(logFC)>logFCmin))
DEGs <- addWoundCtrl(DEGs, woundIDs)
save_DEGs(DEGs, folder, cont, FDRmax, logFCmin, dirPath)

hist(allGenes$PValue, breaks=40, main=paste(cont, "p-value histogram", sep=" "),
         xlab = "p-value")
figFile <- makeFname(folder=paste(folder, "/plots", sep=""), cont=cont, 
                     dtype="_p_val_hist", FDRmax=FDRmax, logFCmin=logFCmin)
figFile <- file.path(dirPath, figFile)
dev.copy(png, figFile)
dev.off()

# -- specific --- # 
allGenesphyB_RvS <- allGenes
DEGsphyB_RvS <- DEGs

head(DEGs, 20)

```


### phyB R-S vs WT R-S

```{r}
# --- inputs --- #
folder <- "geno_x_timepoint"
cont <- "phyB.R-S_vs_WT.R-S"
FDRmax <- 0.1
logFCmin <- 0
# --- ------ --- #

qlf <- glmQLFTest(LmFit, contrast=fullContrasts[, cont])
allGenes <- as.data.frame(topTags(qlf, n=Inf, p.value=1)) 
DEGs <- subset(allGenes, (FDR<FDRmax) & (abs(logFC)>logFCmin))
DEGs <- addWoundCtrl(DEGs, woundIDs)
save_DEGs(DEGs, folder, cont, FDRmax, logFCmin, dirPath)

hist(allGenes$PValue, breaks=40, main=paste(cont, "p-value histogram", sep=" "),
         xlab = "p-value")
figFile <- makeFname(folder=paste(folder, "/plots", sep=""), cont=cont, 
                     dtype="_p_val_hist", FDRmax=FDRmax, logFCmin=logFCmin)
figFile <- file.path(dirPath, figFile)
dev.copy(png, figFile)
dev.off()

# --- specific --- #

DEGs_RvS <- DEGs
```



### venn diagarm R vs. S

```{r}
# --- inputs --- #
folder <- "timepoint_v_timepoint/RvS_venn"
cont <- "RvS"
FDRmax <- 0.01
logFCmin <- 3
# --- ------ --- #


RvS_CommonGenes <- mergeGenes(DEGsphyB_RvS, DEGsWT_RvS) 
colnames(RvS_CommonGenes) <- gsub("\\.x", "_phyB", colnames(RvS_CommonGenes))
colnames(RvS_CommonGenes) <- gsub("\\.y", "_WT", colnames(RvS_CommonGenes))
RvS_CommonGenes <- dplyr::left_join(RvS_CommonGenes, edinburghGeneInfo, by="Gene_ID")
fname <- makeFname(folder=folder, cont="RvS_CommonGenes", FDRmax=FDRmax, logFCmin=logFCmin)
fPath <- file.path(dirPath, fname)
write.csv(RvS_CommonGenes, fPath, row.names=TRUE)

RvS_WT_Only <- DEGsWT_RvS[!(row.names(DEGsWT_RvS) %in% RvS_CommonGenes$Gene_ID), ]
save_DEGs(RvS_WT_Only, folder, "RvS_WT_only", FDRmax, logFCmin, dirPath)

RvS_phyB_Only <- DEGsphyB_RvS[!(row.names(DEGsphyB_RvS) %in% RvS_CommonGenes$Gene_ID), ]
save_DEGs(RvS_phyB_Only, folder, "RvS_phyB_only", FDRmax, logFCmin, dirPath)

plot.new()
temp <- draw.pairwise.venn(area1=nrow(RvS_WT_Only)+nrow(RvS_CommonGenes), 
                           area2=nrow(RvS_phyB_Only)+nrow(RvS_CommonGenes), 
                           cross.area=nrow(RvS_CommonGenes), 
                   fill=c("blue", "red"), category=c("WT R vs. S", "phyB R vs. S"))
grid.draw(temp)

figFile <- makeFname(folder=folder, cont=cont, dtype="_Venn_diag", FDRmax=FDRmax, logFCmin=logFCmin)
figFile <- file.path(dirPath, figFile)
dev.copy(png, figFile)
dev.off()


```


```{r}

allGenes_RvS <- mergeGenes(allGenesWT_RvS, allGenesphyB_RvS)

allGenes_RvS$group <- rep("Neither", nrow(allGenes_RvS))
allGenes_RvS[row.names(RvS_WT_Only), ]$group <- "WT_Only"
allGenes_RvS[row.names(RvS_phyB_Only), ]$group <- "phyB_Only"
allGenes_RvS[RvS_CommonGenes$Gene_ID, ]$group <- "Both"
allGenes_RvS[row.names(DEGs_RvS), ]$group <- "WT(R-S) vs. phyB(R-S) FDR<0.1"
allGenes_RvS_sig <- subset(allGenes_RvS, group != "Neither")

cols <- c("Neither"="grey", "WT_Only"="blue", "phyB_Only"="red", 
          "Both"="purple", "WT(R-S) vs. phyB(R-S) FDR<0.1"="green")

ggplot(allGenes_RvS, aes(x=PValue.x, y=PValue.y, color=group)) +
  geom_point(data=subset(allGenes_RvS, group=="Neither"), alpha=0.2) +
  geom_point(data=subset(allGenes_RvS, group=="Both"), alpha=0.5) +
  geom_point(data=subset(allGenes_RvS, group=="phyB_Only")) +  
  geom_point(data=subset(allGenes_RvS, group=="WT_Only")) +  
  geom_point(data=subset(allGenes_RvS, group=="WT(R-S) vs. phyB(R-S) FDR<0.1")) +  
  scale_color_manual(values=cols) +
  scale_x_log10() + scale_y_log10() + 
  labs(x = "WT p-value", y="phyB p-value", title="p-values R vs. S")

figFile <- makeFname(folder=folder, cont=cont, dtype="_pval_plot", FDRmax=FDRmax, logFCmin=logFCmin)
figFile <- file.path(dirPath, figFile)
dev.copy(png, figFile)
dev.off()


ggplot(allGenes_RvS, aes(x=logFC.x, y=logFC.y, color=group)) +
  geom_point(data=subset(allGenes_RvS, group=="Neither"), alpha=0.2) +
  geom_point(data=subset(allGenes_RvS, group=="Both"), alpha=.5) +
  geom_point(data=subset(allGenes_RvS, group=="phyB_Only")) +  
  geom_point(data=subset(allGenes_RvS, group=="WT_Only")) +  
  geom_point(data=subset(allGenes_RvS, group=="WT(R-S) vs. phyB(R-S) FDR<0.1")) +  
  scale_color_manual(values=cols) + 
  labs(x = "WT Log2 Fold Change", y="phyB Log2 Fold Change", title="Log Fold Change R vs. S")

figFile <- makeFname(folder=folder, cont=cont, dtype="_logFC_plot", FDRmax=FDRmax, logFCmin=logFCmin)
figFile <- file.path(dirPath, figFile)
dev.copy(png, figFile)
dev.off()
```


## phyB vs WT at each timepoint (exact tests)


### phyB.P vs WT.P

Note: we're using woundDGEdata here

```{r echo=FALSE}
# --- inputs --- #
folder <- "phyB_v_WT_at_timepoint"
cont <- "phyB.P_vs_WT.P_exact"
conds <- c("phyB.P", "WT.P")
FDRmax <- 0.05
logFCmin <- 2
# --- ------ --- #
exTest <- exactTest(woundDGEdata, pair=conds)
allGenes <- as.data.frame(topTags(exTest, n=Inf, p.value=1)) 
DEGs <- subset(allGenes, (FDR<FDRmax) & (abs(logFC)>logFCmin))
save_DEGs(DEGs, folder, cont, FDRmax, logFCmin, dirPath)

hist(allGenes$PValue, breaks=40, main=paste(cont, "p-value histogram", sep=" "),
         xlab = "p-value")

figFile <- makeFname(folder=paste(folder, "/plots", sep=""), cont=cont, 
                     dtype="_p_val_hist", FDRmax=FDRmax, logFCmin=logFCmin)
figFile <- file.path(dirPath, figFile)

dev.copy(png, figFile)
dev.off()

# --- specific --- #
allGenesP <- allGenes
DEGsP <- DEGs
```


### phyB.24 vs WT.24

Note: we're using woundDGEdata here

```{r echo=FALSE}
# --- inputs --- #
folder <- "phyB_v_WT_at_timepoint"
cont <- "phyB.24_vs_WT.24_exact"
conds <- c("phyB.24", "WT.24")
FDRmax <- 0.05
logFCmin <- 2
# --- ------ --- #
exTest <- exactTest(woundDGEdata, pair=conds)
allGenes <- as.data.frame(topTags(exTest, n=Inf, p.value=1)) 
DEGs <- subset(allGenes, (FDR<FDRmax) & (abs(logFC)>logFCmin))
save_DEGs(DEGs, folder, cont, FDRmax, logFCmin, dirPath)

hist(allGenes$PValue, breaks=40, main=paste(cont, "p-value histogram", sep=" "),
         xlab = "p-value")

figFile <- makeFname(folder=paste(folder, "/plots", sep=""), cont=cont, 
                     dtype="_p_val_hist", FDRmax=FDRmax, logFCmin=logFCmin)
figFile <- file.path(dirPath, figFile)

dev.copy(png, figFile)
dev.off()

# --- specific --- #
allGenes24 <- allGenes
DEGs24 <- DEGs
```


### phyB.S vs WT.S

```{r echo=FALSE}
# --- inputs --- #
folder <- "phyB_v_WT_at_timepoint"
cont <- "phyB.S_vs_WT.S_exact"
conds <- c("phyB.S", "WT.S")
FDRmax <- 0.05
logFCmin <- 2
# --- ------ --- #
exTest <- exactTest(DGEdata, pair=conds)
allGenes <- as.data.frame(topTags(exTest, n=Inf, p.value=1)) 
DEGs <- subset(allGenes, (FDR<FDRmax) & (abs(logFC)>logFCmin))
save_DEGs(DEGs, folder, cont, FDRmax, logFCmin, dirPath)

hist(allGenes$PValue, breaks=40, main=paste(cont, "p-value histogram", sep=" "),
         xlab = "p-value")

figFile <- makeFname(folder=paste(folder, "/plots", sep=""), cont=cont, 
                     dtype="_p_val_hist", FDRmax=FDRmax, logFCmin=logFCmin)
figFile <- file.path(dirPath, figFile)

dev.copy(png, figFile)
dev.off()

# --- specific --- #
allGenesS <- allGenes
DEGsS <- DEGs
```


### phyB.R vs WT.R

```{r echo=FALSE}
# --- inputs --- #
folder <- "phyB_v_WT_at_timepoint"
cont <- "phyB.R_vs_WT.R_exact"
conds <- c("phyB.R", "WT.R")
FDRmax <- 0.05
logFCmin <- 2
# --- ------ --- #
exTest <- exactTest(DGEdata, pair=conds)
allGenes <- as.data.frame(topTags(exTest, n=Inf, p.value=1)) 
DEGs <- subset(allGenes, (FDR<FDRmax) & (abs(logFC)>logFCmin))
save_DEGs(DEGs, folder, cont, FDRmax, logFCmin, dirPath)

hist(allGenes$PValue, breaks=40, main=paste(cont, "p-value histogram", sep=" "),
         xlab = "p-value")

figFile <- makeFname(folder=paste(folder, "/plots", sep=""), cont=cont, 
                     dtype="_p_val_hist", FDRmax=FDRmax, logFCmin=logFCmin)
figFile <- file.path(dirPath, figFile)

dev.copy(png, figFile)
dev.off()

# --- specific --- #
allGenesR <- allGenes
DEGsR <- DEGs
```









### compare allGenes P and R:

```{r}

allGenes_RvP <- mergeGenes(allGenesWT_RvP, allGenesphyB_RvP)
RvP_commonGenes <- commonGenes(DEGsWT_RvP, DEGsphyB_RvP)

plot.new()
temp <- draw.pairwise.venn(area1=nrow(DEGsWT_RvP), 
                           area2=nrow(DEGsphyB_RvP), 
                           cross.area=nrow(RvP_commonGenes), 
                   fill=c("blue", "red"), category=c("WT R vs. P", "phyB R vs. P"))


allGenes_RvP$group <- rep("Neither", nrow(allGenesPandR))
allGenes_RvP[row.names(DEGsWT_RvP), ]$group <- "WT_Only"
allGenes_RvP[row.names(DEGsphyB_RvP), ]$group <- "phyB_Only"
allGenes_RvP[row.names(RvP_commonGenes), ]$group <- "Both"


ggplot(allGenes_RvP, aes(x=logFC.x, y=logFC.y)) + #geom_point() +
  geom_point(data=subset(allGenes_RvP, group=="Neither"), alpha=0.2, color="grey") +
  geom_point(data=subset(allGenes_RvP, group=="Both"), alpha=1, color="purple") +
  geom_point(data=subset(allGenes_RvP, group=="phyB_Only"), color="red") +  
  geom_point(data=subset(allGenes_RvP, group=="WT_Only"), color="blue") +  
  #geom_point(data=subset(allGenes_PandR, group=="WT(R-S) vs. phyB(R-S) FDR<0.1")) +  
  
  # scale_x_log10() + scale_y_log10() +
  labs(x = "WT logFC", y="phyB logFC", title="R-P logFC values WT vs. phyB")


ggplot(allGenes_RvP, aes(x=PValue.x, y=PValue.y)) + #geom_point() +
  geom_point(data=subset(allGenes_RvP, group=="Neither"), alpha=0.2, color="grey") +
  geom_point(data=subset(allGenes_RvP, group=="Both"), alpha=1, color="purple") +
  geom_point(data=subset(allGenes_RvP, group=="phyB_Only"), color="red") +  
  geom_point(data=subset(allGenes_RvP, group=="WT_Only"), color="blue") +  
  #geom_point(data=subset(allGenes_PandR, group=="WT(R-S) vs. phyB(R-S) FDR<0.1")) +  
  
  scale_x_log10() + scale_y_log10() +
  labs(x = "WT p-value", y="phyB p-value", title="R-P p-values WT vs. phyB")


```





```{r}
#plot.new()
#tripVenn(DEGsRvS, DEGsR, DEGsS, c("RvsS (WT+phyB)", "R (WTvs.phyB)", "S (WTvs.phyB)"))

nVenn(list("RvsS (WT+phyB)"=row.names(DEGsRvS), "R (WTvs.phyB)"=row.names(DEGsR),
           "S (WTvs.phyB)"=row.names(DEGsS)))

#plot.new()
#tripVenn(DEGsSvP, DEGsS, DEGsP, c("SvsP (WT+phyB)", "S (WTvs.phyB)", "P (WTvs.phyB)"))

nVenn(list("SvsP (WT+phyB)"=row.names(DEGsSvP), "S (WTvs.phyB)"=row.names(DEGsS),
           "P (WTvs.phyB)"=row.names(DEGsP)))

```

# PCA

```{r}

cpmData <- cpm(senRecDGEdata)
cpmData <- cpmData[, !grepl("24$", colnames(cpmData))]
pcaData <- cpmData
  
pca <- prcomp(t(pcaData), scale=TRUE)



plotData <- as.data.frame(pca$x)
plotData$sample <- row.names(plotData)
plotData <- tidyr::separate(plotData, sample, into=c("genotype", "plant", "treatment"), sep="_", remove=FALSE)
plotData$group <- paste(plotData$genotype, plotData$treatment, sep="_")

Palette <- c("#68d53f", "#c7dd27", "#c6874e", "red")

ggplot(plotData, aes(x=PC1, y=PC2, color=treatment, shape=genotype)) + 
  geom_point(size=4) + scale_colour_manual(values=Palette)


```


```{r}
ggplot(plotData, aes(x=PC2, y=PC3, color=treatment, shape=genotype)) + 
  geom_point(size=4) + scale_colour_manual(values=Palette)
```
```{r}
theta = -0.33*pi
#theta = 0.4*pi

plotData$PC2.3A <- plotData$PC3*sin(theta) + plotData$PC2*cos(theta)
plotData$PC2.3B <- plotData$PC3*cos(theta) - plotData$PC2*sin(theta)

ggplot(plotData, aes(x=PC1, y=PC2.3A, color=treatment, shape=genotype)) + 
  geom_point(size=4) + scale_colour_manual(values=Palette)

newPCs <- data.frame("PC2.3A" = pca$rotation[, 3]*sin(theta) + 
                       pca$rotation[, 2]*cos(theta), 
                     "PC2.3B"=pca$rotation[, 3]*cos(theta) -
                       pca$rotation[, 2]*sin(theta), 
                     row.names=row.names(pca$rotation))

```




```{r}
PC2.3sdev <- data.frame("PC" = c(2,3), "sdev"=c(
  sqrt((pca$sdev[3]*sin(theta))^2 + (pca$sdev[2]*cos(theta))^2),
  sqrt((pca$sdev[3]*cos(theta))^2 + (pca$sdev[2]*sin(theta))^2)
))

sdevData <- data.frame("PC" = 1:length(pca$sdev), "sdev"=pca$sdev)





ggplot() + geom_point(data=sdevData, aes(x=PC, y=sdev, 
                                         colour="Principal Components"), size=4) + 
  geom_point(data=PC2.3sdev, aes(x=PC, y=sdev, color="PC2.3 rotation"), size=4) +
  labs(title="Standard deviation of principal components")

# plot(x=1:length(pca$sdev), y=pca$sdev)
```


### do a PCA with only genes listed as "Yes" for Leaf_development

```{r}
leafDevGenes <- subset(edinburghGeneInfo2, Leaf_development=="YES")$Gene_ID
leafDevGenes <- leafDevGenes[leafDevGenes %in% row.names(pcaData)]

leafPcaData <- pcaData[leafDevGenes, ]
  
pca <- prcomp(t(leafPcaData), scale=TRUE)

plotData <- as.data.frame(pca$x)
plotData$sample <- row.names(plotData)
plotData <- tidyr::separate(plotData, sample, into=c("genotype", "plant#", "treatment"), sep="_", remove=FALSE)
plotData$group <- paste(plotData$genotype, plotData$treatment, sep="_")

Palette <- c("#68d53f", "#c7dd27", "#c6874e")

ggplot(plotData, aes(x=PC1, y=PC2, color=treatment, shape=genotype)) + 
  geom_point(size=4) + scale_colour_manual(values=Palette)


```

```{r}
ggplot(plotData, aes(x=PC2, y=PC3, color=treatment, shape=genotype)) + 
  geom_point(size=4) + scale_colour_manual(values=Palette)
```

```{r}
theta = -0.33*pi

plotData$PC2.2 <- plotData$PC3*sin(theta) + plotData$PC2*cos(theta)

ggplot(plotData, aes(x=PC1, y=PC2.3A, color=treatment, shape=genotype)) + 
  geom_point(size=4) + scale_colour_manual(values=Palette)

```





```{r}
plot(x=1:length(pca$sdev), y=pca$sdev)
```


```{r}


testSdevs <- c(2.3782, 1.4429, 0.71008, 0.51481, 0.42797, 0.35184,
               0.32413, 0.2419, 0.14896)

sumDev <- sum(testSdevs)
sumsquaredev <- sqrt(sum(testSdevs^2))

```

```{r}
## S VS P
write.csv(t(SvP_WT_Only$A._thaliana_best_hit), file="C:/Users/Morgan/Documents/Lab Stuff/RNA seq/My_results/GO_lists/SvP_WT_Only.csv", row.names = FALSE, quote=FALSE)

write.csv(t(SvP_phyB_Only$A._thaliana_best_hit), file="C:/Users/Morgan/Documents/Lab Stuff/RNA seq/My_results/GO_lists/SvP_phyB_Only.csv", row.names = FALSE, quote=FALSE)

write.csv(t(SvP_CommonGenes$A._thaliana_best_hit), file="C:/Users/Morgan/Documents/Lab Stuff/RNA seq/My_results/GO_lists/SvP_CommonGenes.csv", row.names = FALSE, quote=FALSE)


## R VS S
write.csv(t(RvS_WT_Only$A._thaliana_best_hit), file="C:/Users/Morgan/Documents/Lab Stuff/RNA seq/My_results/GO_lists/RvS_WT_Only.csv", row.names = FALSE, quote=FALSE)

write.csv(t(RvS_phyB_Only$A._thaliana_best_hit), file="C:/Users/Morgan/Documents/Lab Stuff/RNA seq/My_results/GO_lists/RvS_phyB_Only.csv", row.names = FALSE, quote=FALSE)

write.csv(t(RvS_CommonGenes$A._thaliana_best_hit), file="C:/Users/Morgan/Documents/Lab Stuff/RNA seq/My_results/GO_lists/RvS_CommonGenes.csv", row.names = FALSE, quote=FALSE)

#



```




